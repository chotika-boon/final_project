import streamlit as st
import pandas as pd

def show_register():
    # ---------- Load data ----------
    df = pd.read_csv("credit_card.csv")

    st.markdown("<h2 style='text-align:center;'>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>", unsafe_allow_html=True)

    # ---------- Section: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ----------
    st.markdown("### üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ")

    col1, col2 = st.columns(2)
    with col1:
        username = st.text_input("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ")
    with col2:
        email = st.text_input("‡∏≠‡∏µ‡πÄ‡∏°‡∏•")

    col1, col2 = st.columns(2)
    with col1:
        password = st.text_input("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô", type="password")
    with col2:
        confirm_password = st.text_input("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô", type="password")

    # ---------- Section: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï ----------
    st.markdown("### üí≥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï")

    # ‚úÖ Step 1: ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
    bank_list = sorted(df["‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£"].dropna().unique())
    default_bank = bank_list[0] if bank_list else None
    selected_bank = st.selectbox("üè¶ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£", options=bank_list, index=0)

    # ‚úÖ Step 2: ‡∏Å‡∏£‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ï‡∏£
    product_df = df[df["‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£"] == selected_bank]
    product_list = sorted(product_df["‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå/‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ï‡∏£"].dropna().unique())
    default_product = product_list[0] if product_list else None
    selected_product = st.selectbox("üí≥ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ï‡∏£", options=product_list, index=0)

    # ‚úÖ Step 3: ‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£
    issuer_df = product_df[product_df["‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå/‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ï‡∏£"] == selected_product]
    issuer_list = sorted(issuer_df["‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£"].dropna().unique())
    default_issuer = issuer_list[0] if issuer_list else None
    selected_issuer = st.selectbox("üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£", options=issuer_list, index=0)

    # ---------- Submit Button ----------
    if st.button("‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å"):
        if not username or not email or not password:
            st.warning("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô")
        elif password != confirm_password:
            st.error("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô")
        else:
            st.success(f"‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì {username} üéâ")
            st.session_state.page = "login"
            st.rerun()

    # ---------- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ----------
    if st.button("üîÅ ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"):
        st.session_state.page = "login"
        st.rerun()
